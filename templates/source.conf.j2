# {{ ansible_managed }}

{% for file in cycloid_files_watched %}
<worker 0>
  <source>
    @type tail
    tag cycloid.{{file.name}}
    path {{file.path}}
    pos_file /var/log/td-agent/cycloid.{{file.name}}.pos
{% if file.format is defined %}
  format {{file.format}}
{% else %}
  format none
{% endif %}
  </source>
</worker>
{% endfor %}

{% for file in cycloid_system_files_watched %}
<worker 0>
  <source>
    @type tail
    tag cycloid.{{file.name}}
    path {{file.path}}
    pos_file /var/log/td-agent/cycloid.{{file.name}}.pos
{% if file.format is defined %}
  format {{file.format}}
{% else %}
  format none
{% endif %}
  </source>
</worker>
{% endfor %}

{% if fluentd_metrics %}
# expose metrics in prometheus format
<source>
  @type prometheus
  bind 0.0.0.0
  port 24231
  metrics_path /metrics
</source>
<source>
  @type prometheus_output_monitor
  interval 10
  <labels>
    hostname ${hostname}
  </labels>
</source>
{% endif %}
